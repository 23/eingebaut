<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width,initial-scale=1">

    <link rel="icon" type="image/png" href="favicon-32x32.png" sizes="32x32">
    <link rel="stylesheet" href="skeleton.css"/>
    <link rel="stylesheet" href="style.css"/>
    <!-- External dependencies: Lean on jQuery & SWFObject -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="../pv/client-side/libs/mischung/build/mischungBundle.js"></script>
    <!-- <script src="../pv/client-side/libs/mischung/node_modules/@babel/polyfill/dist/polyfill.js"></script> -->

    <!-- Eingebaut itself -->
    <script src="eingebaut.js"></script>
  </head>
  <body>
    <div id="video" style=""></div>
    <script>
     window.eingebaut = new Eingebaut($('#video'), 'mischung', '', function(event){
       if(event=='ready') {
         eingebaut.setSource('samples/kate.misch');
         // eingebaut.setSource('test-videos/ako.misch');
         // setPlaying should be intitated by user action/gesture
         // eingebaut.setPlaying(true);
       }
       console.debug(event);
     });
     window.eingebaut.load();
    </script>

    <div id="controls">
      <div id="buttons">
        <button onclick="window.eingebaut.setPlaying(false);">pause</button>
        <button onclick="window.eingebaut.setPlaying(true);">play</button>
      </div>

      <div id="slider-box">
        <input type="range" id="timeSlider" name="timeSlider" min="0" max="100" step="0.1" value="0" />
      </div>
    </div>
    <script>
      $('#timeSlider').on('change', function() {
        if (typeof window.eingebaut.getDuration() !== 'number') return;

        var val = $('#timeSlider').val();
        var ct = val / 100.0 * window.eingebaut.getDuration();
        window.eingebaut.setCurrentTime(ct);
        console.log('set current time to', ct);
      });

      function updateTimeSlider() {
        if (typeof window.eingebaut.getDuration() !== 'number') return;
        if (typeof window.eingebaut.getCurrentTime() !== 'number') return;

        var ct = window.eingebaut.getCurrentTime();
        var dur = window.eingebaut.getDuration();

        var val = ct / dur * 100.0;
        val = Math.min(val, 100);

        var cur_val = $('#timeSlider').val();

        // if(sliderUpdatedTime != null && (Date.now() - sliderUpdatedTime) > 10000)
        //   return;
        if(Math.abs(cur_val - val) > 5) return;

        $('#timeSlider').val(val);
      }

      $('#timeSlider').val(0);
      window.setInterval(updateTimeSlider, 1000/10);
    </script>
  </body>
</html>
